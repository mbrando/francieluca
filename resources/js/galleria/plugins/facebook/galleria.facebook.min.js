(function($){Galleria.requires(1.25,'The Facebook Plugin requires Galleria version 1.2.5 or later.');var PATH=Galleria.utils.getScriptPath();Galleria.Facebook=function(api_key){this.options={max:40,imageSize:'original',thumbSize:'thumb',description:false,complete:function(){},backlink:false}};Galleria.Facebook.prototype={constructor:Galleria.Facebook,album:function(album_id,callback){return this._find({album_id:album_id},callback)},setOptions:function(options){$.extend(this.options,options);return this},_call:function(params,callback){var url='http://graph.facebook.com/'+params['album_id']+'?callback=?'+'&fields=photos.fields(images,source,picture,link,name)&limit='+this.options.max;var scope=this;$.getJSON(url,function(data){if(data&&data.photos&&data.photos.data&&data.photos.data.length>0){callback.call(scope,data)}else{Galleria.raise('Unable to retrieve Facebook photos from album '+params['album_id'])}});return scope},_getBig:function(photo){return photo.images[0].source},_getSize:function(photo,size){var img;switch(size){case'thumb':img=photo.picture;break;case'small':img=photo.picture;break;case'big':img=this._getBig(photo);break;case'original':img=photo.source;break;default:img=photo.source;break}return img},_find:function(params,callback){return this._call(params,function(data){var gallery=[],photos=data.photos.data,len=Math.min(this.options.max,photos.length),photo,i;for(i=0;i<len;i++){photo=photos[i];gallery.push({thumb:this._getSize(photo,this.options.thumbSize),image:this._getSize(photo,this.options.imageSize),big:this._getBig(photo),title:photo.name,description:this.options.description&&photo.name?photo.name:'',link:this.options.backlink?photo.link:''})}callback.call(this,gallery)})}};var load=Galleria.prototype.load;Galleria.prototype.load=function(){if(arguments.length||typeof this._options.facebook!=='string'){load.apply(this,Galleria.utils.array(arguments));return}var self=this,args=Galleria.utils.array(arguments),facebook=this._options.facebook.split(':'),f,opts=$.extend({},self._options.facebookOptions),loader=typeof opts.loader!=='undefined'?opts.loader:$('<div>').css({width:48,height:48,opacity:0.7,background:'#000 url('+PATH+'loader.gif) no-repeat 50% 50%'});if(facebook.length){if(typeof Galleria.Facebook.prototype[facebook[0]]!=='function'){Galleria.raise(facebook[0]+' method not found in Facebook plugin');return load.apply(this,args)}if(!facebook[1]){Galleria.raise('No facebook argument found');return load.apply(this,args)}window.setTimeout(function(){self.$('target').append(loader)},100);f=new Galleria.Facebook();if(typeof self._options.facebookOptions==='object'){f.setOptions(self._options.facebookOptions)}f[facebook[0]](facebook[1],function(data){self._data=data;loader.remove();self.trigger(Galleria.DATA);f.options.complete.call(f,data)})}else{load.apply(this,args)}}}(jQuery));